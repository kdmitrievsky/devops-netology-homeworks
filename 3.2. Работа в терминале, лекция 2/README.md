## 3.2. Работа в терминале, лекция 2

1. **cd** - это встроенная команда командного интерпретатора (sh, bash, csh и т.д.) а не отдельная программа.  
При вызове “**man cd**” выдается страница bash со всеми командами   


2. Альтернативой **grep <some_string> <some_file> | wc -l** может быть команда grep с ключом -c (**grep -c**)  


3. Процессом с PID 1 в виртуальной машине является процесс systemd - подсистема инициализации и управления сервисами в Linux.


4. Перенаправление в соседний терминал ошибок команды **ls** :  
   `ls -l /root 2> /dev/pts/1`  


5. Одновременно передать команде файл на stdin и вывести ее stdout можно.
    Пример:  
`tail <./infile >./outfile`  


6. Вывести находясь в графическом режиме данные из PTY в какой-либо из эмуляторов TTY можно через перенаправление.
    Увидеть перенаправленные данные можно переключившись в соответствующий контекст, например через комбинацию клавиш Ctrl+Alt+F?


7. Команда **bash 5>&1** созает новую сессию bash, в ней дескриптор 5 и перенаправляет его в stdout. Команда **echo netology > /proc/$$/fd/5** выведет на экран **netology**, т.к. команда **echo** перенаправляет вывод netology в 5-й дескриптор, а он в свою очередь перенаправлен на стандартный вывод.


8. В качестве входного потока для pipe использовать только stderr команды можно через промежуточный дескриптор.  
Пример без перенаправления:  
```  
vagrant@vagrant:~$ ls -l /root | grep denied -c  
ls: cannot open directory '/root': Permission denied  
0  
```  
  
Пример с перенаправлением:  
  
```
vagrant@vagrant:~$ ls -l /root 6>&2 2>&1 1>&6 | grep denied -c
1
```


9. Команда **cat /proc/$$/environ** выведет переменные окружения для текущего процесса.
Аналогичный вывод можно получит командами **env** и **printenv**.  
  

10. По адресу /proc/\<PID>/cmdline доступны аргументы командной строки запущенного процесса.  
    По адресу /proc/\<PID>/exe доступна ссылка на исполняемый файл процесса


11. 4.2 старшая версия набора инструкций SSE которую поддерживает процессор.  
    Команда: **grep sse /proc/cpuinfo**


12. Как я понимаю ssh ждет логина пользователя и шелл еще не запущен, локальный tty отсутствует.  
    Решение: запустить ssh с ключом -t который форсирует запуск коммандной оболочки
    ```
    vagrant@vagrant:~$ ssh -t localhost 'tty'
    vagrant@localhost's password:
    /dev/pts/1
    
    Connection to localhost closed.
      
    ```

13. Получилось перенести **top** с **/dev/tty1** в **/dev/pts/2** (в screen) только изменив **kernel.yama.ptrace.scope=0** в **/etc/sysctl.d/10-ptrace.conf**  
Судя по тексту ошибки, без этой настройки ядро разрешает манипулировать только дочерними процессами.  
```
vagrant@vagrant:~$ ps -an
    PID TTY      STAT   TIME COMMAND
    655 tty1     Ss     0:00 /bin/login -p --
    998 tty1     S      0:00 -bash
   1045 pts/0    Ss     0:00 -bash
   1120 pts/0    S+     0:00 screen -S first
   1123 pts/1    Ss     0:00 /bin/bash
   1130 tty1     S+     0:00 top
   1134 pts/1    R+     0:00 ps -an
vagrant@vagrant:~$ reptyr 1130
vagrant@vagrant:~$ ps -an
    PID TTY      STAT   TIME COMMAND
    655 tty1     Ss     0:00 /bin/login -p --
    998 tty1     S      0:00 -bash
   1045 pts/0    Ss     0:00 -bash
   1120 pts/0    S+     0:00 screen -S first
   1123 pts/1    Ss     0:00 /bin/bash
   1130 pts/2    Ss+    0:02 top
   1135 pts/1    S+     0:06 reptyr 1130
   1137 tty1     Z      0:00 [top] <defunct>
   1138 tty1     R+     0:00 ps -an
vagrant@vagrant:~$
```  

15. Tee - команда записывающая информацию переданную на ее вход в один или несколько файлов. Если перенаправление “>” выполняется с правами shell, то с помощью sudo tee можно изменить права.  
